name: Assign DS issue to someone

on:
  issues:
    types: [opened]
  pull_request:
    branches:
      - main
      - 'release'
      - 'release/*'
      - 'release-*'
  check_run:
    types: [rerequested, requested_action]

permissions:
  issues: write

jobs:
  assignIssue:
    name: Assign Issue to Someone
    runs-on: ubuntu-latest
    if: github.repository == 'microsoft/vscode-jupyter'
    steps:
      - uses: actions/checkout@v2
      - name: Created internally
        id: internal
        env:
            ISSUE_OWNER: ${{github.event.issue.user.login}}
        run: |
          echo ::set-output name=result::$(node -p -e "['amunger', 'IanMatthewHuff', 'DonJayamanne', 'minsa110', 'rebornix', 'roblourens', 'kieferrm'].filter(item => process.env.ISSUE_OWNER.toLowerCase() === item.toLowerCase()).length > 0 ? 1 : 0")
        shell: bash
      - name: Should we proceed
        id: proceed
        env:
            ISSUE_LABELS: ${{toJson(github.event.issue.labels)}}
            ISSUE_ASSIGNEES: ${{toJson(github.event.issue.assignees)}}
            ISSUE_IS_INTERNAL: ${{steps.internal.outputs.result}}
        run: |
          echo ::set-output name=result::$(node -p -e "process.env.ISSUE_IS_INTERNAL === '0' && JSON.parse(process.env.ISSUE_ASSIGNEES).length === 0 ? 1 : 0")
        shell: bash
      - name: Day of week
        if: steps.proceed.outputs.result == 1
        id: day
        run: |
          echo ::set-output name=number::$(node -p -e "new Date().getDay()")
        shell: bash
      - name: Hour of day
        if: steps.proceed.outputs.result == 1
        id: hour
        run: |
          echo ::set-output name=hour::$(node -p -e "(new Date().getUTCHours() - 7)%24")
        shell: bash
      - name: Week Number
        if: steps.proceed.outputs.result == 1
        id: week
        run: |
          echo ::set-output name=odd::$(node .github/workflows/week.js)
        shell: bash
      - name: Print day and week
        if: steps.proceed.outputs.result == 1
        run: |
          echo ${{steps.day.outputs.number}}
          echo ${{steps.week.outputs.odd}}
          echo ${{steps.hour.outputs.hour}}
        shell: bash
      - name: Saturday (Don)
        uses: actions/github-script@v6.2.0
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            github.rest.issues.addAssignees({
              issue_number: 6054,
              owner: context.repo.owner,
              repo: context.repo.repo,
              assignees: ['DonJayamanne']
            })
